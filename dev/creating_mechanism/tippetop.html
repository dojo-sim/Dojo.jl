<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Detailed Mechanism Definition · Dojo</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Dojo</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Get Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/simulation.html">Simulation</a></li><li><a class="tocitem" href="../examples/reinforcement_learning.html">Reinforcement Learning</a></li><li><a class="tocitem" href="../examples/system_identification.html">System Identification</a></li><li><a class="tocitem" href="../examples/trajectory_optimization.html">Trajectory Optimization</a></li></ul></li><li><span class="tocitem">Creating a Mechanism</span><ul><li><a class="tocitem" href="overview.html">Overview</a></li><li><a class="tocitem" href="mechanism_directly.html">Directly Build a Mechanism</a></li><li><a class="tocitem" href="mechanism_existing.html">Using an Existing Mechanism</a></li><li><a class="tocitem" href="environment_existing.html">Using an Existing Environment</a></li><li class="is-active"><a class="tocitem" href="tippetop.html">Detailed Mechanism Definition</a></li><li><a class="tocitem" href="quadruped.html">Loading a Mechanism via URDF</a></li></ul></li><li><span class="tocitem">Creating a Simulation</span><ul><li><a class="tocitem" href="../creating_simulation/define_simulation.html">Defining a Simulation</a></li><li><a class="tocitem" href="../creating_simulation/define_controller.html">Defining a Controller</a></li><li><a class="tocitem" href="../creating_simulation/simulation_with_gradients.html">Gradients</a></li></ul></li><li><span class="tocitem">Environments</span><ul><li><a class="tocitem" href="../environments/overview.html">Overview</a></li></ul></li><li><span class="tocitem">Background: Contact Models</span><ul><li><a class="tocitem" href="../background_contact/contact_models.html">Overview</a></li><li><a class="tocitem" href="../background_contact/impact.html">Impact</a></li><li><a class="tocitem" href="../background_contact/nonlinear_friction.html">Nonlinear friction</a></li><li><a class="tocitem" href="../background_contact/linearized_friction.html">Linearized Friction</a></li><li><a class="tocitem" href="../background_contact/collisions.html">Collisions</a></li></ul></li><li><span class="tocitem">Background: Representations</span><ul><li><a class="tocitem" href="../background_representations/maximal_representation.html">Maximal Coordinates</a></li><li><a class="tocitem" href="../background_representations/minimal_representation.html">Minimal Coordinates</a></li><li><a class="tocitem" href="../background_representations/gradients.html">Background on Gradients</a></li></ul></li><li><span class="tocitem">Background: Solver</span><ul><li><a class="tocitem" href="../background_solver/interior_point.html">Algorithm</a></li><li><a class="tocitem" href="../background_solver/solver_options.html">Solver Options</a></li></ul></li><li><a class="tocitem" href="../api.html">API Documentation</a></li><li><a class="tocitem" href="../contributing.html">Contributing</a></li><li><a class="tocitem" href="../citing.html">Citing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Creating a Mechanism</a></li><li class="is-active"><a href="tippetop.html">Detailed Mechanism Definition</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tippetop.html">Detailed Mechanism Definition</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/dojo-sim/Dojo.jl/blob/main/docs/src/creating_mechanism/tippetop.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Detailed-Mechanism-Definition"><a class="docs-heading-anchor" href="#Detailed-Mechanism-Definition">Detailed Mechanism Definition</a><a id="Detailed-Mechanism-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Detailed-Mechanism-Definition" title="Permalink"></a></h1><p>Here, we describe in detail how to define your own dynamical system of <a href="../api.html#Dojo.Mechanism"><code>Mechanism</code></a>. After it has been defined, it will be extremely easy to simulate it, control it, perform trajectory optimization on it, or even policy optimization.</p><p>We&#39;re going to build a tippe top:</p><img src="../assets/animations/tippetop_real.gif" width="300"/><img src="../assets/animations/tippetop.gif" width="300"/><h3 id="Build-Mechanism"><a class="docs-heading-anchor" href="#Build-Mechanism">Build Mechanism</a><a id="Build-Mechanism-1"></a><a class="docs-heading-anchor-permalink" href="#Build-Mechanism" title="Permalink"></a></h3><p>We will take a look at the definition of <code>get_tippetop</code> in <code>DojoEnvironments</code>. This function return a <a href="../api.html#Dojo.Mechanism"><code>Mechanism</code></a> and takes as input a variety of parameters like the simulation time step, gravity etc. You can add as many parameters you want. This example is typical of what you will find in Dojo.</p><p>To build the mechanism corresponding to the tippe top, we decompose it into two spherical bodies. Each body has its own spherical contact constraint with the floor. The joint between the two bodies is a <code>Fixed</code> joint and the joint between the main body and the <a href="../api.html#Dojo.Origin"><code>Origin</code></a> of the frame is a <code>Floating</code> joint.</p><pre><code class="language-julia hljs">function get_tippetop(;
    timestep=0.01,
    input_scaling=timestep, 
    gravity=-9.81,
    mass=1,
    radius=0.5,
    scale=0.2,
    color=RGBA(0.9, 0.9, 0.9, 1.0),
    springs=0,
    dampers=0, 
    limits=false,
    joint_limits=Dict(),
    keep_fixed_joints=false, 
    friction_coefficient=0.4,
    contact=true,
    contact_type=:nonlinear,
    T=Float64)

    # mechanism
    origin = Origin{T}(name=:origin)
    
    bodies = [
        Sphere(radius, mass; name=:sphere1, color),
        Sphere(radius*scale, mass*scale^3; name=:sphere2, color)
    ]
    bodies[1].inertia = Diagonal([1.9, 2.1, 2])

    joints = [
        JointConstraint(Floating(origin, bodies[1]); name=:floating_joint),
        JointConstraint(Fixed(bodies[1], bodies[2];
            parent_vertex=[0,0,radius]), name = :fixed_joint)
    ]

    mechanism = Mechanism(origin, bodies, joints;
        timestep, gravity, input_scaling)

    # springs and dampers
    set_springs!(mechanism.joints, springs)
    set_dampers!(mechanism.joints, dampers)

    # joint limits    
    if limits
        joints = set_limits(mechanism, joint_limits)

        mechanism = Mechanism(mechanism.origin, mechanism.bodies, joints;
            gravity, timestep, input_scaling)
    end
    
    # contacts
    contacts = ContactConstraint{T}[]

    if contact
        n = length(bodies)
        normals = fill(Z_AXIS,n)
        friction_coefficients = fill(friction_coefficient,n)
        contact_radii = [radius;radius*scale]
        contacts = [contacts;contact_constraint(bodies, normals; friction_coefficients, contact_radii, contact_type)]
    end

    mechanism = Mechanism(mechanism.origin, mechanism.bodies, mechanism.joints, contacts;
        gravity, timestep, input_scaling)

    # zero configuration
    initialize_tippetop!(mechanism)

    # construction finished
    return mechanism
end</code></pre><h3 id="Initialize-Mechanism"><a class="docs-heading-anchor" href="#Initialize-Mechanism">Initialize Mechanism</a><a id="Initialize-Mechanism-1"></a><a class="docs-heading-anchor-permalink" href="#Initialize-Mechanism" title="Permalink"></a></h3><p>The second method that we need to look at is <code>initialize_tippetop!</code>. This function initialize the dynamical system to a certain state. This means that we set the position orientation, linear and angular velocity of each body in the mechanism.</p><pre><code class="language-julia hljs">function initialize_tippetop!(mechanism::Mechanism{T};
    body_position=2*Z_AXIS*mechanism.bodies[1].shape.r, body_orientation=one(Quaternion),
    body_linear_velocity=zeros(3), body_angular_velocity=[0.0, 0.1, 50.0]) where T

    # zero state
    zero_velocities!(mechanism)
    zero_coordinates!(mechanism)

    # set desired state value 
    floating_joint = mechanism.joints[1]
    set_minimal_coordinates!(mechanism, floating_joint, 
        [body_position; Dojo.rotation_vector(body_orientation)])
    set_minimal_velocities!(mechanism, floating_joint, 
        [body_linear_velocity; body_angular_velocity])
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="environment_existing.html">« Using an Existing Environment</a><a class="docs-footer-nextpage" href="quadruped.html">Loading a Mechanism via URDF »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 2 April 2024 13:05">Tuesday 2 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
