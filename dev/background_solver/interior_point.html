<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Algorithm · Dojo</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Dojo</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Get Started</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/simulation.html">Simulation</a></li><li><a class="tocitem" href="../examples/reinforcement_learning.html">Reinforcement Learning</a></li><li><a class="tocitem" href="../examples/system_identification.html">System Identification</a></li><li><a class="tocitem" href="../examples/trajectory_optimization.html">Trajectory Optimization</a></li></ul></li><li><span class="tocitem">Creating a Mechanism</span><ul><li><a class="tocitem" href="../creating_mechanism/overview.html">Overview</a></li><li><a class="tocitem" href="../creating_mechanism/mechanism_directly.html">Directly Build a Mechanism</a></li><li><a class="tocitem" href="../creating_mechanism/mechanism_existing.html">Using an Existing Mechanism</a></li><li><a class="tocitem" href="../creating_mechanism/environment_existing.html">Using an Existing Environment</a></li><li><a class="tocitem" href="../creating_mechanism/tippetop.html">Detailed Mechanism Definition</a></li><li><a class="tocitem" href="../creating_mechanism/quadruped.html">Loading a Mechanism via URDF</a></li></ul></li><li><span class="tocitem">Creating a Simulation</span><ul><li><a class="tocitem" href="../creating_simulation/define_simulation.html">Defining a Simulation</a></li><li><a class="tocitem" href="../creating_simulation/define_controller.html">Defining a Controller</a></li><li><a class="tocitem" href="../creating_simulation/simulation_with_gradients.html">Gradients</a></li></ul></li><li><span class="tocitem">Environments</span><ul><li><a class="tocitem" href="../environments/overview.html">Overview</a></li></ul></li><li><span class="tocitem">Background: Contact Models</span><ul><li><a class="tocitem" href="../background_contact/contact_models.html">Overview</a></li><li><a class="tocitem" href="../background_contact/impact.html">Impact</a></li><li><a class="tocitem" href="../background_contact/nonlinear_friction.html">Nonlinear friction</a></li><li><a class="tocitem" href="../background_contact/linearized_friction.html">Linearized Friction</a></li><li><a class="tocitem" href="../background_contact/collisions.html">Collisions</a></li></ul></li><li><span class="tocitem">Background: Representations</span><ul><li><a class="tocitem" href="../background_representations/maximal_representation.html">Maximal Coordinates</a></li><li><a class="tocitem" href="../background_representations/minimal_representation.html">Minimal Coordinates</a></li><li><a class="tocitem" href="../background_representations/gradients.html">Background on Gradients</a></li></ul></li><li><span class="tocitem">Background: Solver</span><ul><li class="is-active"><a class="tocitem" href="interior_point.html">Algorithm</a></li><li><a class="tocitem" href="solver_options.html">Solver Options</a></li></ul></li><li><a class="tocitem" href="../api.html">API Documentation</a></li><li><a class="tocitem" href="../contributing.html">Contributing</a></li><li><a class="tocitem" href="../citing.html">Citing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Background: Solver</a></li><li class="is-active"><a href="interior_point.html">Algorithm</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="interior_point.html">Algorithm</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/dojo-sim/Dojo.jl/blob/main/docs/src/background_solver/interior_point.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h1><h3 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h3><p>To simulate the system forward in time, we need to solve a Nonlinear Complementarity Problem (NCP) at each time step. To efficiently and reliably satisfy the NCP, we developed a custom primal-dual interior-point solver for NCPs with cone constraints and quaternions. The algorithm is largely based upon Mehrotra&#39;s predictor-corrector algorithm, while borrowing practical numerical features from CVXOPT to handle cones and non-Euclidean optimization to handle quaternions. We also introduce heuristics that further improve reliability and overall performance of the solver for our simulation-step NCPs.</p><p>The primary advantages of this algorithm are the correction to the classic Newton step, which can greatly reduce the iterations required by the solver (often halving the total number of iterations), and feedback on the problem&#39;s central-path parameter that helps avoid premature ill-conditioning and adaptively drives the complementarity violation to zero in order to reliably simulate hard contact.</p><h3 id="Problem-formulation"><a class="docs-heading-anchor" href="#Problem-formulation">Problem formulation</a><a id="Problem-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-formulation" title="Permalink"></a></h3><p>The solver aims to satisfy instantiations of the following problem:</p><p class="math-container">\[\begin{align*}
\text{find} &amp; \quad  x, y, z \\
\text{subject to} &amp; \quad  c(x, y, z; \theta) = 0, \\
&amp; \quad y^{(i)} \circ z^{(i)} = \kappa \mathbf{e}, &amp;&amp; \quad i = 1,\dots,n, \\
&amp; \quad y^{(i)}, z^{(i)} \in \mathcal{K}, &amp;&amp; \quad i = 1,\dots, n,
\end{align*}\]</p><p>with decision variables <span>$x \in \mathbf{R}^k$</span> and <span>$y, z \in \mathbf{R}^m$</span>, equality-constraint set <span>$c : \mathbf{R}^k \times \mathbf{R}^m \times \mathbf{R}^m \times \mathbf{R}^l \rightarrow \mathbf{R}^h$</span>, problem data <span>$\theta \in \mathbf{R}^l$</span>; and where <span>$\mathcal{K}$</span> is the Cartesian product of <span>$n$</span> total positive-orthant and second-order cones. The variables are partitioned: <span>$x = (x^{(1)}, \dots, x^{(p)})$</span>, where <span>$i = 1$</span> are Euclidean variables and <span>$i = 2, \dots, p$</span> are each quaternion variables; and <span>$y = (y^{(1)}, \dots, y^{(n)})$</span>, <span>$z = (z^{(1)}, \dots, z^{(n)})$</span>, where <span>$j = 1$</span> is the positive-orthant and the remaining <span>$j = 2, \dots, n$</span> are second-order cones. For convenience, we denote <span>$w = (x, y, z)$</span>.</p><p>The algorithm aims to satisfy a sequence of relaxed problems with <span>$\kappa &gt; 0$</span> and <span>$\kappa \rightarrow 0$</span> in order to reliably converge to a solution of the original problem (i.e., <span>$\kappa = 0$</span>). This continuation approach helps avoid premature ill-conditioning and is the basis for numerous convex and non-convex general-purpose interior-point solvers.</p><h3 id="Violation-metrics:"><a class="docs-heading-anchor" href="#Violation-metrics:">Violation metrics:</a><a id="Violation-metrics:-1"></a><a class="docs-heading-anchor-permalink" href="#Violation-metrics:" title="Permalink"></a></h3><p>Two metrics are used to measure progress: The constraint violation,</p><p class="math-container">\[r_{\text{vio}} = \| c(w; \theta) \|_{\infty},\]</p><p>and complementarity violation,</p><p class="math-container">\[b_{\text{vio}} = {\text{max}}_i \{\| y^{(i)} \circ z^{(i)} \|_{\infty}\}.\]</p><p>The NCP is considered solved when <span>$r_{\text{vio}} &lt; r_{\text{tol}}$</span> and <span>$b_{\text{vio}} &lt; b_{\text{tol}}$</span>.</p><div class="admonition is-info"><header class="admonition-header">solver options</header><div class="admonition-body"><p>Both <code>r_tol</code> and <code>b_tol</code> are options that can easily be accessed and modified via <a href="../api.html#Dojo.SolverOptions"><code>SolverOptions</code></a>.</p></div></div><h3 id="Newton-Steps"><a class="docs-heading-anchor" href="#Newton-Steps">Newton Steps</a><a id="Newton-Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Newton-Steps" title="Permalink"></a></h3><p>The main loop of the solver performs Newton&#39;s method on the equality-constraint set <span>$c$</span> and the bilinear constraints. The solver typically converges in about 10 iterations.</p><div class="admonition is-info"><header class="admonition-header">solver options</header><div class="admonition-body"><p>The maximal number of Newton&#39;s iterations <code>max_iter</code> can be set via <a href="../api.html#Dojo.SolverOptions"><code>SolverOptions</code></a>.</p></div></div><h3 id="Line-Search"><a class="docs-heading-anchor" href="#Line-Search">Line Search</a><a id="Line-Search-1"></a><a class="docs-heading-anchor-permalink" href="#Line-Search" title="Permalink"></a></h3><p>Newton&#39;s method provides a search direction, then we perform a line search along this direction to determine the step length <span>$\alpha$</span>. We use a backtracking line search that accepts the step whenever it decreases <span>$c_{\text{vio}}$</span> or <span>$b_{\text{vio}}$</span>. The line search starts with a step <span>$\alpha=1$</span>, if the step acceptance conditions are not met the step is decreased geometrically: <span>$\alpha \leftarrow s \cdot \alpha$</span>. The line search takes at most <code>max_ls</code> backtracking steps.</p><div class="admonition is-info"><header class="admonition-header">solver options</header><div class="admonition-body"><p>The scaling parameter <span>$s$</span> is called <code>ls_scale</code> and the maximum number of line search iteration <code>max_ls</code> can be set via <a href="../api.html#Dojo.SolverOptions"><code>SolverOptions</code></a>.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../background_representations/gradients.html">« Background on Gradients</a><a class="docs-footer-nextpage" href="solver_options.html">Solver Options »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 22 August 2023 13:37">Tuesday 22 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
